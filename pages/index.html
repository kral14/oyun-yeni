<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tower Defense Game</title>
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- GitHub Pages base path -->
    <script>
        (function() {
            const isGitHubPages = window.location.hostname.includes('github.io');
            if (isGitHubPages) {
                const repoName = window.location.pathname.split('/')[1] || 'oyun-yeni';
                const base = '/' + repoName + '/';
                const baseTag = document.createElement('base');
                baseTag.href = base;
                document.head.insertBefore(baseTag, document.head.firstChild);
            }
        })();
    </script>
    <link rel="stylesheet" href="assets/style.css?v=1">
    <link rel="stylesheet" href="assets/components/profile/profile.css?v=1">
    <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="assets/manifest.webmanifest">
    <meta name="theme-color" content="#0a84ff">
    <meta name="mobile-web-app-capable" content="yes">
    <script>
        (function(){
            function isMobileEnv(){
                try {
                    var mq = window.matchMedia ? window.matchMedia('(max-width: 900px)') : { matches:false };
                    var small = mq.matches;
                    var touch = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                    return small || touch;
                } catch(e) { return false; }
            }
            function maybeRedirect(){
                var alreadyMobile = /(?:mobile\.html|\/mobile\/?(?:index\.html)?)$/i.test(window.location.pathname);
                if (isMobileEnv() && !alreadyMobile) {
                    window.location.replace('mobile.html');
                }
            }
            var debounce;
            function onResize(){
                clearTimeout(debounce);
                debounce = setTimeout(maybeRedirect, 120);
            }
            // initial check
            maybeRedirect();
            // react to changes
            window.addEventListener('resize', onResize);
            window.addEventListener('orientationchange', onResize);
        })();
    </script>
    <script>
        // Auto cache-busting loader: always request fresh JS/CSS
        (function(){
            try {
                var v = Date.now().toString();
                // Bust CSS link if present
                var links = document.querySelectorAll('link[rel="stylesheet"]');
                links.forEach(function(l){
                    var href = l.getAttribute('href') || '';
                    var base = href.split('?')[0];
                    l.setAttribute('href', base + '?v=' + v);
                });
                // Inject versioned game.js before closing head
                var head = document.getElementsByTagName('head')[0];
                var s = document.createElement('script');
                s.src = 'assets/game.js?v=' + v;
                s.defer = false;
                head.appendChild(s);
                // Profil JavaScript
                var profileScript = document.createElement('script');
                profileScript.src = 'assets/components/profile/profile.js?v=' + v;
                profileScript.defer = false;
                head.appendChild(profileScript);
                // Prevent duplicate base script later
                window.__INJECTED_VERSIONED_SCRIPT__ = true;
                window.__BUILD_VERSION__ = v;
            } catch(e) {}
        })();
    </script>
    <script>
        // Register service worker for PWA installability
        (function(){
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function(){
                    // Before registering new SW, clear old caches and unregister to avoid stale assets
                    Promise.resolve().then(function(){
                        return caches && caches.keys ? caches.keys().then(function(keys){
                            return Promise.all(keys.map(function(k){ return caches.delete(k); }));
                        }) : null;
                    }).then(function(){
                        return navigator.serviceWorker.getRegistrations();
                    }).then(function(regs){
                        return Promise.all(regs.map(function(r){ return r.unregister(); }));
                    }).catch(function(){})
                    .finally(function(){
                        const swPath = 'assets/sw.js?v=' + (window.__BUILD_VERSION__ || Date.now());
                        navigator.serviceWorker.register(swPath).then(function(reg){
                            if (reg && reg.update) reg.update();
                        }).catch(function(){});
                    });
                });
            }
        })();
    </script>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>Q√ºll…ô M√ºdafi…ôsi</h1>
            <div class="game-stats">
                <div class="stat">
                    <span class="stat-label">Saƒülamlƒ±q:</span>
                    <span id="health">100</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Pul:</span>
                    <span id="money">500</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Dalƒüa:</span>
                    <span id="wave">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Xal:</span>
                    <span id="score">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">S…ôviyy…ô:</span>
                    <span id="level">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">üíé:</span>
                    <span id="diamonds">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">‚≠ê:</span>
                    <span id="stars">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">D√º≈üm…ônl…ôr:</span>
                    <span id="enemyCount">0</span>
                </div>
                <div class="stat toggle-shop-stat" title="Q√ºll…ô Maƒüazasƒ±">
                    <button id="toggleShop" class="toggle-shop">üè™</button>
                </div>
            </div>
            <div class="profile-section">
                <div class="profile-info">
                    <span class="profile-icon">üë§</span>
                    <span id="profileUsername" class="profile-username">ƒ∞stifad…ô√ßi</span>
                </div>
                <div class="profile-dropdown" id="profileDropdown">
                    <div class="profile-dropdown-content">
                        <div class="profile-menu-item" id="editProfileBtn">
                            <span>Profili D√ºz…ôlt</span>
                        </div>
                        <div class="profile-menu-item" id="logoutBtn">
                            <span>√áƒ±xƒ±≈ü</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="board-wrap">
                <canvas id="gameCanvas" width="1280" height="720"></canvas>
                <div id="labelW" class="size-label size-label-w">u: 1280</div>
                <div id="labelH" class="size-label size-label-h">h: 720</div>
            </div>
            
            <div class="tower-shop hidden">
                <div class="shop-tabs">
                    <button class="shop-tab active" data-tab="tab-controls">ƒ∞dar…ôtm…ôl…ôr</button>
                    <button class="shop-tab" data-tab="tab-towers">Q√ºll…ôl…ôr</button>
                    <button class="shop-tab" data-tab="tab-special">X√ºsusi</button>
                </div>
                
                <div class="shop-content-wrapper">
                <div class="shop-tab-content active" id="tab-controls">
                    <div class="game-controls" style="display: flex; flex-direction: column; gap: 12px; padding: 15px;">
                        <button id="startWave" class="game-controls" style="width: 100%; padding: 12px; font-size: 14px;">Dalƒüanƒ± Ba≈ülat</button>
                        <div class="auto-start-container" style="display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                            <input type="checkbox" id="autoStart" />
                            <label for="autoStart" style="color: #fff; cursor: pointer;">Avtomatik Ba≈ülat</label>
                        </div>
                        <button id="restartGame" class="game-controls" style="width: 100%; padding: 12px; font-size: 14px;">Yenid…ôn ba≈ülat</button>
                        <button id="pauseGame" class="game-controls" style="width: 100%; padding: 12px; font-size: 14px; background: linear-gradient(45deg, #ff9800, #f57c00);">‚è∏Ô∏è Fasil…ô</button>
                        <button id="resumeGame" class="game-controls" style="width: 100%; padding: 12px; font-size: 14px; background: linear-gradient(45deg, #4CAF50, #45a049); display: none;">‚ñ∂Ô∏è Davam</button>
                        <button id="saveGameState" class="game-controls" style="width: 100%; padding: 12px; font-size: 14px; background: linear-gradient(45deg, #4CAF50, #45a049);">üíæ Oyunu Qeyd Et</button>
                        
                        <!-- Avtomatik Can Yenil…ôm…ô B√∂lm…ôsi -->
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button id="globalAutoHealToggle" class="game-controls" style="width: 100%; padding: 10px; font-size: 13px; background: linear-gradient(45deg, #4a90e2, #357abd);">üîÑ Avto Can Yenil…ôm…ô</button>
                                
                                <!-- Q√ºll…ô Se√ßim Paneli (gizli) -->
                                <div id="globalAutoHealPanel" style="display: none; flex-direction: column; gap: 8px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px; max-height: 300px; overflow-y: auto;">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <input type="number" id="globalAutoHealThreshold" min="1" value="5" style="width: 70px; padding: 6px; background: rgba(0,0,0,0.5); border: 1px solid #00bcd4; border-radius: 4px; color: #fff; font-size: 12px;" />
                                        <label style="color: #fff; font-size: 12px;">Can D…ôy…ôri (1-100)</label>
                                    </div>
                                    <div id="globalAutoHealTowersList" style="display: flex; flex-direction: column; gap: 6px;">
                                        <!-- Q√ºll…ôl…ôr buraya dinamik olaraq …ôlav…ô olunacaq -->
                                    </div>
                                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                                        <button id="globalAutoHealSelectAll" style="flex: 1; padding: 8px; background: rgba(74, 144, 226, 0.3); border: 1px solid #4a90e2; border-radius: 4px; color: #fff; cursor: pointer; font-size: 11px;">Hamƒ±sƒ±nƒ± Se√ß</button>
                                        <button id="globalAutoHealDeselectAll" style="flex: 1; padding: 8px; background: rgba(74, 144, 226, 0.3); border: 1px solid #4a90e2; border-radius: 4px; color: #fff; cursor: pointer; font-size: 11px;">Se√ßimi L…ôƒüv Et</button>
                                    </div>
                                    <button id="globalAutoHealConfirm" class="game-controls" style="width: 100%; padding: 10px; font-size: 13px; background: linear-gradient(45deg, #4CAF50, #45a049);">‚úì T…ôsdiql…ô v…ô Aktiv Et</button>
                                </div>
                            </div>
                        </div>
                        <div class="speed-controls" style="display: flex; align-items: center; gap: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                            <label style="color: #fff; font-size: 13px;">S√ºr…ôt:</label>
                            <button id="speed1" class="speed-btn" style="flex: 1; padding: 8px;">1x</button>
                            <button id="speed2" class="speed-btn" style="flex: 1; padding: 8px;">2x</button>
                            <button id="speed3" class="speed-btn" style="flex: 1; padding: 8px;">3x</button>
                        </div>
                    </div>
                </div>

                <div class="shop-tab-content" id="tab-towers">
                    <div class="tower-options" style="padding: 20px;">
                        <div class="tower-option" data-tower="basic" data-damage="20" data-firerate="1000" data-cost="$50">
                            <div class="tower-icon basic-tower"></div>
                            <div class="tower-info">
                                <div class="tower-name">Sad…ô Q√ºll…ô</div>
                                <div class="tower-cost">$50</div>
                            </div>
                            <div class="tower-tooltip">
                                <div class="tooltip-title">Sad…ô Q√ºll…ô</div>
                                <div class="tooltip-stats">
                                    <div>‚öîÔ∏è Z…ôr…ôr: 20</div>
                                    <div>üî• At…ô≈ü s√ºr…ôti: 1.0s</div>
                                    <div>üí∞ Qiym…ôt: $50</div>
                                </div>
                                <div class="tooltip-desc">Balanslƒ± z…ôr…ôr v…ô at…ô≈ü s√ºr…ôti il…ô orta s…ôviyy…ôli q√ºll…ô</div>
                            </div>
                        </div>
                        <div class="tower-option" data-tower="rapid" data-damage="10" data-firerate="300" data-cost="$100">
                            <div class="tower-icon rapid-tower"></div>
                            <div class="tower-info">
                                <div class="tower-name">S√ºr…ôtli Q√ºll…ô</div>
                                <div class="tower-cost">$100</div>
                            </div>
                            <div class="tower-tooltip">
                                <div class="tooltip-title">S√ºr…ôtli Q√ºll…ô</div>
                                <div class="tooltip-stats">
                                    <div>‚öîÔ∏è Z…ôr…ôr: 10</div>
                                    <div>üî• At…ô≈ü s√ºr…ôti: 0.3s</div>
                                    <div>üí∞ Qiym…ôt: $100</div>
                                </div>
                                <div class="tooltip-desc">√áox s√ºr…ôtli at…ô≈ü a√ßƒ±r, az z…ôr…ôr verir - √ßox sayda d√º≈üm…ôn √º√ß√ºn ideal</div>
                            </div>
                        </div>
                        <div class="tower-option" data-tower="heavy" data-damage="50" data-firerate="2000" data-cost="$200">
                            <div class="tower-icon heavy-tower"></div>
                            <div class="tower-info">
                                <div class="tower-name">Aƒüƒ±r Q√ºll…ô</div>
                                <div class="tower-cost">$200</div>
                            </div>
                            <div class="tower-tooltip">
                                <div class="tooltip-title">Aƒüƒ±r Q√ºll…ô</div>
                                <div class="tooltip-stats">
                                    <div>‚öîÔ∏è Z…ôr…ôr: 50</div>
                                    <div>üî• At…ô≈ü s√ºr…ôti: 2.0s</div>
                                    <div>üí∞ Qiym…ôt: $200</div>
                                </div>
                                <div class="tooltip-desc">√áox g√ºcl√º z…ôr…ôr verir, lakin yava≈ü at…ô≈ü a√ßƒ±r - g√ºcl√º d√º≈üm…ônl…ôr √º√ß√ºn</div>
                            </div>
                        </div>
                        <div class="tower-option" data-tower="ice" data-star-cost="1" data-damage="15" data-firerate="800" data-cost="‚≠ê1">
                            <div class="tower-icon ice-tower"></div>
                            <div class="tower-star-cost">‚≠ê1</div>
                            <div class="tower-info">
                                <div class="tower-name">Buz Q√ºll…ôsi</div>
                                <div class="tower-cost">‚≠ê1</div>
                            </div>
                            <div class="tower-tooltip">
                                <div class="tooltip-title">Buz Q√ºll…ôsi</div>
                                <div class="tooltip-stats">
                                    <div>‚öîÔ∏è Z…ôr…ôr: 15</div>
                                    <div>üî• At…ô≈ü s√ºr…ôti: 0.8s</div>
                                    <div>üí∞ Qiym…ôt: ‚≠ê1</div>
                                </div>
                                <div class="tooltip-desc">Buz m…ôrmisi d√º≈üm…ônl…ôri dondurur v…ô yava≈üladƒ±r</div>
                            </div>
                        </div>
                        <div class="tower-option" data-tower="flame" data-star-cost="2" data-damage="25" data-firerate="1000" data-cost="‚≠ê2">
                            <div class="tower-icon flame-tower"></div>
                            <div class="tower-star-cost">‚≠ê2</div>
                            <div class="tower-info">
                                <div class="tower-name">Alov Q√ºll…ôsi</div>
                                <div class="tower-cost">‚≠ê2</div>
                            </div>
                            <div class="tower-tooltip">
                                <div class="tooltip-title">Alov Q√ºll…ôsi</div>
                                <div class="tooltip-stats">
                                    <div>‚öîÔ∏è Z…ôr…ôr: 25</div>
                                    <div>üî• At…ô≈ü s√ºr…ôti: 1.0s</div>
                                    <div>üí∞ Qiym…ôt: ‚≠ê2</div>
                                </div>
                                <div class="tooltip-desc">Alov m…ôrmisi d√º≈üm…ônl…ôri yandƒ±rƒ±r - zamanla z…ôr…ôr verir</div>
                            </div>
                        </div>
                        <div class="tower-option" data-tower="laser" data-star-cost="3" data-damage="30" data-firerate="500" data-cost="‚≠ê3">
                            <div class="tower-icon laser-tower"></div>
                            <div class="tower-star-cost">‚≠ê3</div>
                            <div class="tower-info">
                                <div class="tower-name">Lazer Q√ºll…ôsi</div>
                                <div class="tower-cost">‚≠ê3</div>
                            </div>
                            <div class="tower-tooltip">
                                <div class="tooltip-title">Lazer Q√ºll…ôsi</div>
                                <div class="tooltip-stats">
                                    <div>‚öîÔ∏è Z…ôr…ôr: 30</div>
                                    <div>üî• At…ô≈ü s√ºr…ôti: 0.5s</div>
                                    <div>üí∞ Qiym…ôt: ‚≠ê3</div>
                                </div>
                                <div class="tooltip-desc">G√ºcl√º lazer at…ô≈üi - y√ºks…ôk z…ôr…ôr v…ô s√ºr…ôtli at…ô≈ü kombinasiyasƒ±</div>
                            </div>
                        </div>
                        <div class="tower-option" data-tower="plasma" data-star-cost="4" data-damage="60" data-firerate="1500" data-cost="‚≠ê4">
                            <div class="tower-icon plasma-tower"></div>
                            <div class="tower-star-cost">‚≠ê4</div>
                            <div class="tower-info">
                                <div class="tower-name">Plazma Q√ºll…ôsi</div>
                                <div class="tower-cost">‚≠ê4</div>
                            </div>
                            <div class="tower-tooltip">
                                <div class="tooltip-title">Plazma Q√ºll…ôsi</div>
                                <div class="tooltip-stats">
                                    <div>‚öîÔ∏è Z…ôr…ôr: 60</div>
                                    <div>üî• At…ô≈ü s√ºr…ôti: 1.5s</div>
                                    <div>üí∞ Qiym…ôt: ‚≠ê4</div>
                                </div>
                                <div class="tooltip-desc">Plazma barier yaradƒ±r - yoldan ke√ß…ôn d√º≈üm…ônl…ôr…ô z…ôr…ôr verir</div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="shop-tab-content" id="tab-special">
                    <div class="shop-placeholder" style="margin-bottom:8px">Oyun Taxtasƒ± (√∂l√ß√º): <span id="boardDims">9√ó15</span> ‚Äî üíé <span id="shopDiamonds">0</span></div>
                    <div class="tower-options">
                        <div class="tower-option" style="cursor:default">
                            <div class="tower-info">
                                <div class="tower-name">+2 S…ôtir (yuxarƒ± + a≈üaƒüƒ±)</div>
                                <div class="tower-cost">üíé<span id="costRows">5</span></div>
                            </div>
                            <button id="buyRows" class="game-controls" style="padding:8px 12px">Al</button>
                        </div>
                        <div class="tower-option" style="cursor:default">
                            <div class="tower-info">
                                <div class="tower-name">+1 S√ºtun (m…ôrk…ôzd…ôn saƒüa)</div>
                                <div class="tower-cost">üíé<span id="costCol">3</span></div>
                            </div>
                            <button id="buyCol" class="game-controls" style="padding:8px 12px">Al</button>
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(0, 212, 255, 0.05); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px;">
                        <div style="margin-bottom: 12px; font-weight: bold; color: #00d4ff; font-size: 14px; text-align: center;">üéÅ H…ôdiyy…ô Kodu</div>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <input type="text" id="giftCodeInput" placeholder="Kodu daxil edin..." 
                                   style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #fff; font-size: 13px; font-family: Arial, sans-serif; box-sizing: border-box;"
                                   autocomplete="off" spellcheck="false">
                            <button id="redeemCode" class="game-controls" 
                                    style="width: 100%; padding: 12px; background: linear-gradient(45deg, #4a90e2, #357abd); border: none; border-radius: 6px; color: #fff; font-weight: bold; cursor: pointer; font-size: 13px;">
                                T…ôsdiq Et
                            </button>
                        </div>
                        <div id="giftCodeMessage" style="font-size: 11px; color: #a0a0a0; text-align: center; margin-top: 10px; min-height: 16px; padding: 5px;"></div>
                    </div>
                </div>
                </div>
            </div>
        </div>
        
        <div class="game-info">
            <div class="selected-tower-info" id="selectedTowerInfo" style="display: none;">
                <h4>Se√ßilmi≈ü Q√ºll…ô</h4>
                <div id="towerDetails"></div>
                <button id="upgradeTower">Y√ºks…ôlt ($<span id="upgradeCost">0</span>)</button>
                <button id="sellTower">Sat ($<span id="sellValue">0</span>)</button>
            </div>
        </div>

        <!-- Context menu that appears near a clicked tower -->
        <div id="towerContext" style="display:none; gap:8px; flex-direction:column; background:rgba(10,10,10,0.92); padding:10px; border:1px solid #00bcd4; border-radius:8px;">
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="ctx-btn" id="ctxRange">üåÄ <span id="ctxRangeVal">0</span> (<span id="ctxRangeUp">0/3</span>) ‚Äî $<span id="ctxRangeCost">50</span></button>
                <button class="ctx-btn" id="ctxDamage">üí• <span id="ctxDamageVal">0</span> (<span id="ctxDamageUp">0/3</span>) ‚Äî $<span id="ctxDamageCost">50</span></button>
                <button class="ctx-btn" id="ctxRate">‚ö° <span id="ctxRateVal">0</span> (<span id="ctxRateUp">0/3</span>) ‚Äî $<span id="ctxRateCost">50</span></button>
            </div>
            <div style="display:flex; gap:8px;">
                <button class="ctx-btn" id="ctxHeal">ü©π $20</button>
                <button class="ctx-btn" id="ctxHealthUpgrade">‚ù§Ô∏è Can Artƒ±r: $50</button>
            </div>
            <div style="display:flex; flex-direction:column; gap:4px; padding:6px; background:rgba(255,255,255,0.05); border-radius:4px;">
                <div style="display:flex; gap:4px; align-items:center;">
                    <button class="ctx-btn" id="ctxAutoHealToggle" style="flex:1;">üîÑ Avto Can: Kapalƒ±</button>
                </div>
                <div id="ctxAutoHealSettings" style="display:none; gap:4px; align-items:center; flex-direction:row;">
                    <input type="number" id="ctxAutoHealThreshold" min="1" value="5" style="width:60px; padding:4px; background:rgba(0,0,0,0.5); border:1px solid #00bcd4; border-radius:4px; color:#fff; font-size:12px;" />
                    <button class="ctx-btn" id="ctxAutoHealConfirm" style="flex:1; padding:4px; font-size:11px;">‚úì T…ôsdiq</button>
                </div>
            </div>
            <button class="ctx-btn" id="ctxAwaken">üåà (üíé20)</button>
            <button class="ctx-btn" id="ctxShield">üõ°Ô∏è (üíé50)</button>
            <div style="display:flex; gap:8px;">
                <button class="ctx-btn" id="ctxPlasmaActivate" style="display:none;">‚ö° Plazma Aktiv</button>
                <button class="ctx-btn" id="ctxPlasmaDeactivate" style="display:none;">‚ö° Plazma S√∂nd√ºr</button>
            </div>
            <div style="display:flex; gap:8px;">
                <button class="ctx-btn" id="ctxSell">ü™ô</button>
            </div>
        </div>
    </div>
    
    <script>
        // Check login status - GitHub Pages √º√ß√ºn skip et
        (function(){
            // GitHub Pages √º√ß√ºn login check skip et (backend yoxdur)
            const isGitHubPages = window.location.hostname.includes('github.io');
            if (isGitHubPages) {
                // GitHub Pages-d…ô backend yoxdur, login check skip
                return;
            }
            // Render-da backend var, login lazƒ±mdƒ±r
            const loggedIn = localStorage.getItem('towerDefenseLoggedIn');
            const userId = localStorage.getItem('towerDefenseUserId');
            if (loggedIn !== 'true' || !userId) {
                window.location.href = 'login.html';
                return;
            }
        })();
        
        // If dynamic loader failed for any reason, fallback to versioned include
        (function(){
            if (!window.__INJECTED_VERSIONED_SCRIPT__) {
                var v = window.__BUILD_VERSION__ || Date.now().toString();
                var s = document.createElement('script');
                s.src = 'assets/game.js?v=' + v;
                document.body.appendChild(s);
            }
        })();
    </script>
    <script>
        // Shop toggle and tabs
        (function(){
            const shop = document.querySelector('.tower-shop');
            const btn = document.getElementById('toggleShop');
            if (shop && btn) {
                // S…ôhif…ô y√ºkl…ôn…ônd…ô maƒüaza baƒülƒ± olmalƒ±dƒ±r (default hidden)
                // localStorage-dan v…ôziyy…ôti yoxla (yoxdursa hidden qal)
                const savedShopState = localStorage.getItem('towerDefenseShopOpen');
                if (savedShopState === 'true') {
                    shop.classList.remove('hidden');
                } else {
                    shop.classList.add('hidden');
                }
                
                // Toggle d√ºym…ôsin…ô klik edildikd…ô v…ôziyy…ôti saxla
                btn.addEventListener('click', function(){
                    shop.classList.toggle('hidden');
                    const isOpen = !shop.classList.contains('hidden');
                    localStorage.setItem('towerDefenseShopOpen', isOpen.toString());
                });
            }
            const tabs = document.querySelectorAll('.shop-tab');
            const pages = document.querySelectorAll('.shop-tab-content');
            tabs.forEach(function(t){
                t.addEventListener('click', function(){
                    tabs.forEach(function(x){ x.classList.remove('active'); });
                    pages.forEach(function(p){ p.classList.remove('active'); });
                    t.classList.add('active');
                    var id = t.getAttribute('data-tab');
                    var page = document.getElementById(id);
                    if (page) page.classList.add('active');
                });
            });
        })();
        
        // Profile section - ayrƒ± faylda (assets/js/profile.js)
    </script>
</body>
</html>
